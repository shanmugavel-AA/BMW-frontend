

import { useState, useRef, useEffect } from "react";
import { useNavigate } from "react-router-dom";
import { Link } from "react-router-dom";


const Header = () => {

  const navigate = useNavigate();
  const [isMenuOpen, setIsMenuOpen] = useState(false);
  const [showServices, setShowServices] = useState(false);
  const [showBusiness, setShowBusiness] = useState(false);
  const [showCompany, setShowCompany] = useState(false);
  const servicesTimeout = useRef();
  const businessTimeout = useRef();
  const companyTimeout = useRef();
  const headerRef = useRef(null);

  const handleScroll = () => {
    if (headerRef.current) {
      if (window.scrollY > 0) {
        // When scrolling down: blend with semi-transparent black
        headerRef.current.style.backgroundColor = 'rgba(2, 2, 2, 0.68)';
      } else {
        // When at top: solid color (white or your theme color)
        headerRef.current.style.backgroundColor = '';
      }
    }
  };

  useEffect(() => {
    window.addEventListener("scroll", handleScroll);
    handleScroll();
    return () => {window.removeEventListener("scroll", handleScroll);
    }
    }, []);

  // Helper for dropdown trigger
  const handleDropdown = (type, show = "hover") => {
    let setShow, timeoutRef;
    if (type === "services") {
      setShow = setShowServices;
      timeoutRef = servicesTimeout;
    } else if (type === "business") {
      setShow = setShowBusiness;
      timeoutRef = businessTimeout;
    } else if (type === "company") {
      setShow = setShowCompany;
      timeoutRef = companyTimeout;
    }
    clearTimeout(timeoutRef.current);
    if (show) {
      setShow(true);
    } else {
      timeoutRef.current = setTimeout(() => setShow(false), 200);
    }
  };

  const handleService = () => {
    navigate("/services");
  }
  const handleBusiness = () => {
    navigate("/business-solutions");
  }

  return (
    <header className="bg-black shadow-md sticky top-0 z-50 transition-all duration-300"
    ref={headerRef}
    >
      {/* Main nav */}
      <div className="w-full py-6 px-4 md:px-8 lg:px-16 flex justify-between items-center">
        <Link
          to="/"
          className="text-2xl font-extrabold tracking-tight text-white space-x-4 transition-colors"
        >
          YourCompany
        </Link>

        {/* Desktop Nav */}
        <nav className="hidden md:flex space-x-4 text-base font-community-sans items-center relative">
          <Link
            to="/"
            className="hover:text-accent transition-colors py-2 px-2 rounded-lg text-white"
          >
            Home
          </Link>
          {/* Services Dropdown */}
          <div
            className="relative"
            data-dropdown-trigger="hover"
            onMouseEnter={(e) => {
              if (
                e.currentTarget.getAttribute("data-dropdown-trigger") ===
                "hover"
              ) {
                handleDropdown("services", true, "hover");
              }
            }}
            onMouseLeave={(e) => {
              if (
                e.currentTarget.getAttribute("data-dropdown-trigger") ===
                "hover"
              ) {
                handleDropdown("services", false, "hover");
              }
            }}
          >
            <button
              className="hover:text-accent flex items-center gap-1 transition-colors py-2 px-2 rounded-lg text-white"
              onClick={handleService}
              type="button"
              aria-haspopup="true"
              aria-expanded={showServices}
            >
              Services <span className="text-xs">▼</span>
            </button>
            <div
              className={`absolute top-full left-0 mt-3 w-80 bg-black p-5 z-50 grid grid-cols-1 gap-3 transition-all duration-300 origin-top scale-95 opacity-0 pointer-events-none
                ${
                  showServices
                    ? "scale-100 opacity-100 pointer-events-auto animate-dropdown"
                    : ""
                } hover:bg-black transition-colors`}
              style={{ minWidth: "16rem" }}
              onMouseEnter={(e) => {
                if (
                  e.currentTarget.parentElement.getAttribute(
                    "data-dropdown-trigger"
                  ) === "hover"
                ) {
                  handleDropdown("services", true, "hover");
                }
              }}
              onMouseLeave={(e) => {
                if (
                  e.currentTarget.parentElement.getAttribute(
                    "data-dropdown-trigger"
                  ) === "hover"
                ) {
                  handleDropdown("services", false, "hover");
                }
              }}
            >
              <Link
                to="/services/seo"
                className="hover:text-accent transition-colors text-white"
              >
                SEO & Content Strategy
              </Link>
              <Link
                to="/services/social-media"
                className="hover:text-accent transition-colors text-white"
              >
                Social Media Marketing
              </Link>
              <Link
                to="/services/performance"
                className="hover:text-accent transition-colors text-white"
              >
                Performance Marketing
              </Link>
              <Link
                to="/services/influencer"
                className="hover:text-accent transition-colors text-white"
              >
                Influencer Marketing
              </Link>
              <Link
                to="/services/web-development"
                className="hover:text-accent transition-colors text-white"
              >
                Web Development
              </Link>
              <Link
                to="/services/branding"
                className="hover:text-accent transition-colors text-white"
              >
                Branding & Identity
              </Link>
              <Link
                to="/services/video"
                className="hover:text-accent transition-colors text-white"
              >
                Video Marketing
              </Link>
              <Link
                to="/services/automation"
                className="hover:text-accent transition-colors text-white"
              >
                Marketing Automation
              </Link>
            </div>
          </div>
          {/* Business Dropdown */}
          <div
            className="relative"
            data-dropdown-trigger="hover"
            onMouseEnter={(e) => {
              if (
                e.currentTarget.getAttribute("data-dropdown-trigger") ===
                "hover"
              ) {
                handleDropdown("business", true, "hover");
              }
            }}
            onMouseLeave={(e) => {
              if (
                e.currentTarget.getAttribute("data-dropdown-trigger") ===
                "hover"
              ) {
                handleDropdown("business", false, "hover");
              }
            }}
          >
            <button
              className="hover:text-accent flex items-center gap-1 transition-colors py-2 px-2 rounded-lg text-white"
              onClick={handleBusiness}
              type="button"
              aria-haspopup="true"
              aria-expanded={showBusiness}
            >
              Business Solutions <span className="text-xs">▼</span>
            </button>
            <div
              className={`absolute top-full left-0 mt-3 w-72 bg-black p-5 z-50 grid grid-cols-1 gap-3 transition-all duration-300 origin-top scale-95 opacity-0 pointer-events-none
                ${
                  showBusiness
                    ? "scale-100 opacity-100 pointer-events-auto animate-dropdown"
                    : ""
                } hover:bg-black transition-colors`}
              style={{ minWidth: "14rem" }}
              onMouseEnter={(e) => {
                if (
                  e.currentTarget.parentElement.getAttribute(
                    "data-dropdown-trigger"
                  ) === "hover"
                ) {
                  handleDropdown("business", true, "hover");
                }
              }}
              onMouseLeave={(e) => {
                if (
                  e.currentTarget.parentElement.getAttribute(
                    "data-dropdown-trigger"
                  ) === "hover"
                ) {
                  handleDropdown("business", false, "hover");
                }
              }}
            >
              <Link
                to="/business-solutions/ecommerce"
                className="hover:text-accent transition-colors text-white"
              >
                E-Commerce & D2C
              </Link>
              <Link
                to="/business-solutions/retail"
                className="hover:text-accent transition-colors text-white"
              >
                FMCG & Retail
              </Link>
              <Link
                to="/business-solutions/finance"
                className="hover:text-accent transition-colors text-white"
              >
                Banking & Financial
              </Link>
              <Link
                to="/business-solutions/startups"
                className="hover:text-accent transition-colors text-white"
              >
                Growth Startups
              </Link>
              <Link
                to="/business-solutions/healthcare"
                className="hover:text-accent transition-colors text-white"
              >
                Healthcare
              </Link>
              <Link
                to="/business-solutions/education"
                className="hover:text-accent transition-colors text-white"
              >
                Education
              </Link>
              <Link
                to="/business-solutions/real-estate"
                className="hover:text-accent transition-colors text-white"
              >
                Real Estate
              </Link>
            </div>
          </div>
          {/* Company Dropdown */}
          <div
            className="relative"
            data-dropdown-trigger="hover"
            onMouseEnter={(e) => {
              if (
                e.currentTarget.getAttribute("data-dropdown-trigger") ===
                "hover"
              ) {
                handleDropdown("company", true, "hover");
              }
            }}
            onMouseLeave={(e) => {
              if (
                e.currentTarget.getAttribute("data-dropdown-trigger") ===
                "hover"
              ) {
                handleDropdown("company", false, "hover");
              }
            }}
          >
            <button
              className="hover:text-accent flex items-center gap-1 transition-colors py-2 px-2 rounded-lg text-white"
              type="button"
              aria-haspopup="true"
              aria-expanded={showCompany}
            >
              Company <span className="text-xs">▼</span>
            </button>
            <div
              className={`absolute top-full left-0 mt-3 w-56 bg-secondary p-5 z-50 grid grid-cols-1 gap-3 transition-all duration-300 origin-top scale-95 opacity-0 pointer-events-none
                ${
                  showCompany
                    ? "scale-100 opacity-100 pointer-events-auto animate-dropdown"
                    : ""
                } hover:bg-secondary transition-colors`}
              style={{ minWidth: "12rem" }}
              onMouseEnter={(e) => {
                if (
                  e.currentTarget.parentElement.getAttribute(
                    "data-dropdown-trigger"
                  ) === "hover"
                ) {
                  handleDropdown("company", true, "hover");
                }
              }}
              onMouseLeave={(e) => {
                if (
                  e.currentTarget.parentElement.getAttribute(
                    "data-dropdown-trigger"
                  ) === "hover"
                ) {
                  handleDropdown("company", false, "hover");
                }
              }}
            >
              <Link
                to="/faq"
                className="hover:text-accent transition-colors text-primary"
              >
                FAQ
              </Link>
              <Link
                to="/about"
                className="hover:text-accent transition-colors text-primary"
              >
                About Us
              </Link>
              <Link
                to="/testimonials"
                className="hover:text-accent transition-colors text-primary"
              >
                Testimonials
              </Link>
              <Link
                to="/case-study"
                className="hover:text-accent transition-colors text-primary"
              >
                CaseStudy
              </Link>
            </div>
          </div>
          <Link
            to="/careers"
            className="hover:text-accent transition-colors py-2 px-2 rounded-lg text-white"
          >
            Careers
          </Link>
          <Link
            to="/blog"
            className="hover:text-accent transition-colors py-2 px-2 rounded-lg text-white"
          >
            Blog
          </Link>
          <Link
            to="/contact"
            className="hover:text-accent transition-colors py-2 px-2 rounded-lg text-white"
          >
            Contact
          </Link>
        </nav>

        {/* Mobile Hamburger */}
        <button
          className="md:hidden text-3xl focus:outline-none p-2 text-white"
          onClick={() => setIsMenuOpen(!isMenuOpen)}
          aria-label="Open menu"
        >
          ☰
        </button>
      </div>

      {/* Mobile Menu */}
      {isMenuOpen && (
        <div className="md:hidden bg-white shadow-2xl fixed top-0 left-0 w-full h-full z-50 animate-fade-in flex flex-col">
          <div className="flex justify-between items-center px-4 py-4 border-b">
            <span className="text-2xl font-extrabold text-accent">
              YourCompany
            </span>
            <button
              className="text-3xl focus:outline-none"
              onClick={() => setIsMenuOpen(false)}
              aria-label="Close menu"
            >
              ×
            </button>
          </div>
          <nav className="flex flex-col space-y-2 p-6 text-base font-medium flex-1 overflow-y-auto text-black">
            <Link
              to="/"
              className="hover:text-accent transition-colors py-2"
              onClick={() => setIsMenuOpen(false)}
            >
              Home
            </Link>
            {/* Mobile Services Dropdown */}
            <div>
              <button
                className="w-full text-left hover:text-accent flex items-center gap-1 transition-colors py-2"
                onClick={() => setShowServices(!showServices)}
                type="button"
                aria-haspopup="true"
                aria-expanded={showServices}
              >
                Services{" "}
                <span className="text-xs">{showServices ? "▲" : "▼"}</span>
              </button>
              <div
                className={`ml-2 mt-1 flex flex-col gap-1 transition-all duration-300 origin-top scale-95 opacity-0 max-h-0 overflow-hidden
                  ${
                    showServices
                      ? "scale-100 opacity-100 max-h-[500px] animate-dropdown"
                      : ""
                  }`}
              >
                <Link
                  to="/services/seo"
                  className="hover:text-accent transition-colors py-1"
                  onClick={() => setIsMenuOpen(false)}
                >
                  SEO & Content Strategy
                </Link>
                <Link
                  to="/services/social-media"
                  className="hover:text-accent transition-colors py-1"
                  onClick={() => setIsMenuOpen(false)}
                >
                  Social Media Marketing
                </Link>
                <Link
                  to="/services/performance"
                  className="hover:text-accent transition-colors py-1"
                  onClick={() => setIsMenuOpen(false)}
                >
                  Performance Marketing
                </Link>
                <Link
                  to="/services/influencer"
                  className="hover:text-accent transition-colors py-1"
                  onClick={() => setIsMenuOpen(false)}
                >
                  Influencer Marketing
                </Link>
                <Link
                  to="/services/web-development"
                  className="hover:text-accent transition-colors py-1"
                  onClick={() => setIsMenuOpen(false)}
                >
                  Web Development
                </Link>
                <Link
                  to="/services/branding"
                  className="hover:text-accent transition-colors py-1"
                  onClick={() => setIsMenuOpen(false)}
                >
                  Branding & Identity
                </Link>
                <Link
                  to="/services/video"
                  className="hover:text-accent transition-colors py-1"
                  onClick={() => setIsMenuOpen(false)}
                >
                  Video Marketing
                </Link>
                <Link
                  to="/services/automation"
                  className="hover:text-accent transition-colors py-1"
                  onClick={() => setIsMenuOpen(false)}
                >
                  Marketing Automation
                </Link>
              </div>
            </div>
            {/* Mobile Business Dropdown */}
            <div>
              <button
                className="w-full text-left hover:text-accent flex items-center gap-1 transition-colors py-2"
                onClick={() => setShowBusiness(!showBusiness)}
                type="button"
                aria-haspopup="true"
                aria-expanded={showBusiness}
              >
                Business Solutions{" "}
                <span className="text-xs">{showBusiness ? "▲" : "▼"}</span>
              </button>
              <div
                className={`ml-2 mt-1 flex flex-col gap-1 transition-all duration-300 origin-top scale-95 opacity-0 max-h-0 overflow-hidden
                  ${
                    showBusiness
                      ? "scale-100 opacity-100 max-h-[500px] animate-dropdown"
                      : ""
                  }`}
              >
                <Link
                  to="/business-solutions/ecommerce"
                  className="hover:text-accent transition-colors py-1"
                  onClick={() => setIsMenuOpen(false)}
                >
                  E-Commerce & D2C
                </Link>
                <Link
                  to="/business-solutions/retail"
                  className="hover:text-accent transition-colors py-1"
                  onClick={() => setIsMenuOpen(false)}
                >
                  FMCG & Retail
                </Link>
                <Link
                  to="/business-solutions/finance"
                  className="hover:text-accent transition-colors py-1"
                  onClick={() => setIsMenuOpen(false)}
                >
                  Banking & Financial
                </Link>
                <Link
                  to="/business-solutions/startups"
                  className="hover:text-accent transition-colors py-1"
                  onClick={() => setIsMenuOpen(false)}
                >
                  Growth Startups
                </Link>
                <Link
                  to="/business-solutions/healthcare"
                  className="hover:text-accent transition-colors py-1"
                  onClick={() => setIsMenuOpen(false)}
                >
                  Healthcare
                </Link>
                <Link
                  to="/business-solutions/education"
                  className="hover:text-accent transition-colors py-1"
                  onClick={() => setIsMenuOpen(false)}
                >
                  Education
                </Link>
                <Link
                  to="/business-solutions/real-estate"
                  className="hover:text-accent transition-colors py-1"
                  onClick={() => setIsMenuOpen(false)}
                >
                  Real Estate
                </Link>
              </div>
            </div>
            {/* Mobile Company Dropdown */}
            <div>
              <button
                className="w-full text-left hover:text-accent flex items-center gap-1 transition-colors py-2"
                onClick={() => setShowCompany(!showCompany)}
                type="button"
                aria-haspopup="true"
                aria-expanded={showCompany}
              >
                Company{" "}
                <span className="text-xs">{showCompany ? "▲" : "▼"}</span>
              </button>
              <div
                className={`ml-2 mt-1 flex flex-col gap-1 transition-all duration-300 origin-top scale-95 opacity-0 max-h-0 overflow-hidden
                  ${
                    showCompany
                      ? "scale-100 opacity-100 max-h-[500px] animate-dropdown"
                      : ""
                  }`}
              >
                <Link
                  to="/faq"
                  className="hover:text-accent transition-colors py-1"
                  onClick={() => setIsMenuOpen(false)}
                >
                  FAQ
                </Link>
                <Link
                  to="/about"
                  className="hover:text-accent transition-colors py-1"
                  onClick={() => setIsMenuOpen(false)}
                >
                  About Us
                </Link>
                <Link
                  to="/testimonials"
                  className="hover:text-accent transition-colors py-1"
                  onClick={() => setIsMenuOpen(false)}
                >
                  Testimonials
                </Link>
              </div>
            </div>
            <Link
              to="/careers"
              className="hover:text-accent transition-colors py-2"
              onClick={() => setIsMenuOpen(false)}
            >
              Careers
            </Link>
            <Link
              to="/contact"
              className="hover:text-accent transition-colors py-2"
              onClick={() => setIsMenuOpen(false)}
            >
              Contact
            </Link>
            <Link
              to="/blog"
              className="hover:text-accent transition-colors py-2"
              onClick={() => setIsMenuOpen(false)}
            >
              Blog
            </Link>
          </nav>
        </div>
      )}

      {/* Animations */}
      <style>
  {`
    @keyframes dropdown {
      0% { opacity: 0; transform: scaleY(0.95) translateY(-10px);}
      100% { opacity: 1; transform: scaleY(1) translateY(0);}
    }
    .animate-dropdown {
      animation: dropdown 0.25s cubic-bezier(0.4,0,0.2,1) both;
    }
      .header {
  transition: background-color 0.3s ease;
}
  `}
</style>
    </header>
  );
};


export default Header;


